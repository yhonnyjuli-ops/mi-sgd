<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SGD Personal - Yhonny Cutipa Juli</title>
<style>
  :root{
    --bg:#f3f5f7;
    --card:#ffffff;
    --accent:#0e3c46;
    --accent-light:#136774;
    --muted:#6b7280;
    --danger:#b91c1c;
  }
  *{box-sizing:border-box;font-family:'Segoe UI',Roboto,Arial,sans-serif;}
  body{margin:0;background:var(--bg);color:#111827;min-height:100vh;}
  header{
    background:var(--card);
    display:flex;align-items:center;gap:12px;
    box-shadow:0 2px 6px rgba(0,0,0,.05);
    padding:12px 20px;
  }
  header .logo{
    width:42px;height:42px;
    background:linear-gradient(135deg,var(--accent),var(--accent-light));
    color:white;border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:15px;
    letter-spacing:1px;
  }
  header h1{font-size:18px;margin:0;}
  .container{max-width:1100px;margin:20px auto;padding:20px;}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:16px;}
  .grid{display:grid;gap:12px;}
  .cols-2{grid-template-columns:1fr 320px;}
  label{font-size:13px;color:var(--muted);margin-bottom:4px;display:block;}
  input,select,textarea{
    width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb;background:white;font-size:14px;
  }
  textarea{min-height:80px;resize:vertical;}
  button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;transition:.2s;}
  button:hover{background:var(--accent-light);}
  .btn-ghost{background:transparent;color:var(--accent);border:1px solid #d1d5db;}
  .small{font-size:13px;padding:6px 10px;}
  .muted{color:var(--muted);font-size:13px;}
  .list{max-height:400px;overflow:auto;}
  .doc-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:8px;}
  .badge{background:var(--accent-light);color:white;border-radius:6px;padding:4px 8px;font-size:12px;}
  .tag{background:#f3f4f6;padding:4px 8px;border-radius:6px;font-size:12px;}
  footer{text-align:center;font-size:13px;color:var(--muted);padding:12px;}
</style>
</head>
<body>
<header>
  <div class="logo">YCJ</div>
  <h1>SGD Personal – Yhonny Cutipa Juli</h1>
  <div id="userLabel" style="margin-left:auto;color:var(--muted);font-size:13px;">No has iniciado sesión</div>
</header>

<div class="container" id="app">
  <div id="auth" class="card">
    <h3>Acceso personal</h3>
    <label>Usuario</label><input type="text" id="authUser">
    <label>Contraseña</label><input type="password" id="authPass">
    <div style="margin-top:10px;display:flex;gap:8px;">
      <button id="btnLogin">Entrar</button>
      <button id="btnRegister" class="btn-ghost">Crear cuenta</button>
      <button id="btnReset" class="btn-ghost small">Restablecer</button>
    </div>
    <p class="muted" style="margin-top:8px;">Los datos se guardan localmente en tu navegador.</p>
  </div>

  <div id="main" style="display:none;">
    <div class="card">
      <h3>Panel de Documentos</h3>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="btnNewDoc" class="small">+ Nuevo</button>
        <button id="btnExport" class="btn-ghost small">Exportar JSON</button>
        <button id="btnLogout" class="btn-ghost small" style="margin-left:auto;">Salir</button>
      </div>
    </div>

    <div class="grid cols-2">
      <div>
        <div class="card">
          <h4>Búsqueda</h4>
          <input id="q" placeholder="Buscar..." style="margin-bottom:6px;">
          <select id="filterType"><option value="">Todos</option><option>Oficio</option><option>Carta</option><option>Informe</option></select>
          <select id="filterState"><option value="">Estados</option><option>En Proyecto</option><option>Emitido</option></select>
          <button id="btnFilter" class="small btn-ghost" style="margin-top:8px;">Filtrar</button>
          <div id="docsList" class="list" style="margin-top:8px;"></div>
        </div>
      </div>

      <div>
        <div id="panelForm" class="card" style="display:none;">
          <h4>Nuevo documento</h4>
          <label>Asunto</label><input id="docAsunto">
          <label>Tipo</label><select id="docTipo"><option>Oficio</option><option>Carta</option><option>Informe</option></select>
          <label>Motivo</label><input id="docMotivo">
          <label>Destinatario</label><input id="docDest">
          <label>Observaciones</label><textarea id="docObs"></textarea>
          <label>Anexo</label><input type="file" id="docFile">
          <div style="display:flex;gap:8px;margin-top:10px;">
            <button id="btnSaveDoc">Guardar</button>
            <button id="btnCancelDoc" class="btn-ghost">Cancelar</button>
          </div>
        </div>

        <div id="panelDetail" class="card" style="display:none;">
          <h4>Detalle</h4>
          <div id="detailBody"></div>
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button id="btnEdit" class="small btn-ghost">Editar</button>
            <button id="btnDelete" class="small" style="background:var(--danger);">Eliminar</button>
            <button id="btnDownload" class="small">Descargar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>© 2025 SGD Personal – Yhonny Cutipa Juli</footer>

<script>
const DB_NAME='sgd_personal_v2';const STORE='docs';
let db;
function openDB(){return new Promise((res,rej)=>{
 const r=indexedDB.open(DB_NAME,1);
 r.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains(STORE)){d.createObjectStore(STORE,{keyPath:'id'});} };
 r.onsuccess=e=>{db=e.target.result;res(db)};r.onerror=e=>rej(e);
});}
function uid(){return 'd'+Date.now()+Math.random().toString(36).slice(2,8)}
function saveDoc(d){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).put(d);tx.oncomplete=res;tx.onerror=rej;});}
function getAll(){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readonly');const r=tx.objectStore(STORE).getAll();r.onsuccess=()=>res(r.result);r.onerror=rej;});}
function getDoc(id){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readonly');const r=tx.objectStore(STORE).get(id);r.onsuccess=()=>res(r.result);r.onerror=rej;});}
function delDoc(id){return new Promise((res,rej)=>{const tx=db.transaction(STORE,'readwrite');tx.objectStore(STORE).delete(id);tx.oncomplete=res;tx.onerror=rej;});}

function qs(x){return document.getElementById(x)}
function hide(e){e.style.display='none'}
function show(e){e.style.display=''}

const AUTH_KEY='sgd_user';
function login(u,p){const s=JSON.parse(localStorage.getItem(AUTH_KEY)||'null');return s&&s.u===u&&s.p===p}
function reg(u,p){localStorage.setItem(AUTH_KEY,JSON.stringify({u,p}))}
function renderAuth(){const u=sessionStorage.getItem('user');if(u){hide(qs('auth'));show(qs('main'));qs('userLabel').textContent=u;loadDocs();}else{show(qs('auth'));hide(qs('main'));qs('userLabel').textContent='No has iniciado sesión';}}

qs('btnRegister').onclick=()=>{if(qs('authUser').value&&qs('authPass').value){reg(qs('authUser').value,qs('authPass').value);alert('Cuenta creada')}};
qs('btnLogin').onclick=()=>{if(login(qs('authUser').value,qs('authPass').value)){sessionStorage.setItem('user',qs('authUser').value);renderAuth()}else alert('Credenciales incorrectas')};
qs('btnLogout').onclick=()=>{sessionStorage.removeItem('user');renderAuth()};
qs('btnReset').onclick=()=>{localStorage.removeItem(AUTH_KEY);alert('Datos reiniciados')};

qs('btnNewDoc').onclick=()=>{show(qs('panelForm'));hide(qs('panelDetail'))}
qs('btnCancelDoc').onclick=()=>{hide(qs('panelForm'))}
qs('btnSaveDoc').onclick=async()=>{
 const id=uid(),now=Date.now();
 const d={id,asunto:qs('docAsunto').value,tipo:qs('docTipo').value,motivo:qs('docMotivo').value,dest:qs('docDest').value,obs:qs('docObs').value,created:now};
 const f=qs('docFile').files[0];if(f){const fr=new FileReader();fr.onload=async()=>{d.file={name:f.name,data:fr.result};await saveDoc(d);loadDocs();hide(qs('panelForm'))};fr.readAsDataURL(f);}else{await saveDoc(d);loadDocs();hide(qs('panelForm'));}
}

async function loadDocs(){
 const arr=await getAll();const q=qs('q').value.toLowerCase();const list=qs('docsList');list.innerHTML='';
 arr.filter(x=>!q||x.asunto.toLowerCase().includes(q)).sort((a,b)=>b.created-a.created).forEach(d=>{
  const div=document.createElement('div');div.className='doc-item';
  div.innerHTML=`<div><div class='badge'>${d.tipo}</div><div><strong>${d.asunto}</strong><br><span class='muted'>${d.dest||''}</span></div></div><div><button class='small btn-ghost'>Ver</button></div>`;
  div.querySelector('button').onclick=()=>showDetail(d.id);list.appendChild(div);
 });
}
async function showDetail(id){const d=await getDoc(id);hide(qs('panelForm'));show(qs('panelDetail'));qs('detailBody').innerHTML=`<strong>${d.asunto}</strong><p>${d.obs||''}</p><small>${new Date(d.created).toLocaleString()}</small>`;qs('btnEdit').onclick=()=>alert('Función editar pendiente');qs('btnDelete').onclick=async()=>{await delDoc(d.id);loadDocs();hide(qs('panelDetail'))};qs('btnDownload').onclick=()=>{if(!d.file){alert('Sin anexo');return;}const a=document.createElement('a');a.href=d.file.data;a.download=d.file.name;a.click();};}
qs('btnExport').onclick=async()=>{const all=await getAll();const a=document.createElement('a');a.href='data:text/json,'+encodeURIComponent(JSON.stringify(all));a.download='sgd_backup.json';a.click();}

openDB().then(renderAuth);
</script>
</body>
</html>
